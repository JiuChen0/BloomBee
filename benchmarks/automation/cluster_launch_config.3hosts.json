{
  "host_defaults": {
    "repo_dir": "/root/BloomBee",
    "activate": "",
    "ssh_options": [
      "BatchMode=yes",
      "StrictHostKeyChecking=accept-new",
      "ServerAliveInterval=30",
      "ServerAliveCountMax=120"
    ]
  },
  "hosts": {
    "dht": {
      "host": "169.236.184.234",
      "user": "charlie",
      "port": 22,
      "repo_dir": "/home/charlie/BloomBee",
      "ssh_options": [
        "BatchMode=yes",
        "StrictHostKeyChecking=accept-new",
        "ServerAliveInterval=30",
        "ServerAliveCountMax=120",
        "IdentityFile=/home/cc/.ssh/id_rsa_charliebb",
        "IdentitiesOnly=yes"
      ]
    },
    "server1": {
      "host": "142.112.39.215",
      "user": "root",
      "port": 42597,
      "ssh_options": [
        "BatchMode=yes",
        "StrictHostKeyChecking=accept-new",
        "ServerAliveInterval=30",
        "ServerAliveCountMax=120",
        "IdentityFile=/home/cc/.ssh/dongli.pem",
        "IdentitiesOnly=yes"
      ]
    },
    "server2": {
      "host": "71.104.167.14",
      "user": "root",
      "port": 50560,
      "ssh_options": [
        "BatchMode=yes",
        "StrictHostKeyChecking=accept-new",
        "ServerAliveInterval=30",
        "ServerAliveCountMax=120",
        "IdentityFile=/home/cc/.ssh/dongli.pem",
        "IdentitiesOnly=yes"
      ]
    },
    "client": {
      "host": "71.104.167.14",
      "user": "root",
      "port": 50560,
      "ssh_options": [
        "BatchMode=yes",
        "StrictHostKeyChecking=accept-new",
        "ServerAliveInterval=30",
        "ServerAliveCountMax=120",
        "IdentityFile=/home/cc/.ssh/dongli.pem",
        "IdentitiesOnly=yes"
      ]
    }
  },
  "schedule": {
    "interval_sec": 1800,
    "startup_wait_sec": 90,
    "teardown_wait_sec": 5,
    "client_timeout_sec": 21600,
    "reuse_dht": true,
    "results_root": "/tmp/bb_sensitivity_runs",
    "run_tag": "weekly_sensitivity"
  },
  "shared_vars": {
    "model": "huggyllama/llama-13b",
    "bbserver": "/ip4/169.236.184.234/tcp/31340/p2p/QmRDC1ahoyUvHFPo2CTqrHjiGUH5fji32eHEEgmnvNrE9R",
    "torch_dtype": "float32",
    "max_batch_size": 22288
  },
  "commands": {
    "dht": "python -m bloombee.cli.run_dht --host_maddrs /ip4/0.0.0.0/tcp/31340 --announce_maddrs /ip4/169.236.184.234/tcp/31340 --identity_path bootstrapp1.id",
    "server1": "CUDA_VISIBLE_DEVICES=0 python -m bloombee.cli.run_server {model} --initial_peers {bbserver} --block_indices 0:20 --identity_path serverNorway.id --public_name nodeNorway --host_maddrs /ip4/0.0.0.0/tcp/53749 --announce_maddrs /ip4/142.112.39.215/tcp/42597 --batch_size {batch_size} --max_batch_size {max_batch_size}",
    "server2": "CUDA_VISIBLE_DEVICES=0 python -m bloombee.cli.run_server {model} --initial_peers {bbserver} --block_indices 20:40 --identity_path serverNorway.id --public_name nodeNorway --host_maddrs /ip4/0.0.0.0/tcp/50560 --announce_maddrs /ip4/71.104.167.14/tcp/50560 --batch_size {batch_size} --max_batch_size {max_batch_size}",
    "client": "python benchmarks/benchmark_inference.py --model {model} --initial_peers {bbserver} --torch_dtype {torch_dtype} --seq_len {seq_len} --batch_size {batch_size} --eval_tokens {eval_tokens}"
  },
  "default_env": {
    "all": {
      "BBSERVER": "{bbserver}",
      "BLOOMBEE_LOSSLESS_ALGO": "zstd",
      "BLOOMBEE_LOSSLESS_LEVEL": "3",
      "BLOOMBEE_LOSSLESS_MIN_BYTES": "49152"
    },
    "server1": {
      "BLOOMBEE_ENABLE_MICROBATCH_PIPELINE": "1"
    },
    "server2": {
      "BLOOMBEE_ENABLE_MICROBATCH_PIPELINE": "1"
    },
    "client": {
      "BLOOMBEE_ENABLE_MICROBATCH_PIPELINE": "1"
    }
  },
  "cases": [
    {
      "name": "bs84_mb8_comp0_eval256",
      "vars": {
        "batch_size": 84,
        "seq_len": 512,
        "eval_tokens": 256,
        "micro_batch_size": 8,
        "lossless_wrapper": 0
      },
      "env": {
        "all": {
          "BLOOMBEE_LOSSLESS_WRAPPER": "{lossless_wrapper}"
        },
        "server1": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "server2": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "client": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        }
      }
    },
    {
      "name": "bs84_mb8_comp1_eval256",
      "vars": {
        "batch_size": 84,
        "seq_len": 512,
        "eval_tokens": 256,
        "micro_batch_size": 8,
        "lossless_wrapper": 1
      },
      "env": {
        "all": {
          "BLOOMBEE_LOSSLESS_WRAPPER": "{lossless_wrapper}"
        },
        "server1": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "server2": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "client": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        }
      }
    },
    {
      "name": "bs84_mb16_comp0_eval256",
      "vars": {
        "batch_size": 84,
        "seq_len": 512,
        "eval_tokens": 256,
        "micro_batch_size": 16,
        "lossless_wrapper": 0
      },
      "env": {
        "all": {
          "BLOOMBEE_LOSSLESS_WRAPPER": "{lossless_wrapper}"
        },
        "server1": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "server2": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "client": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        }
      }
    },
    {
      "name": "bs84_mb16_comp1_eval256",
      "vars": {
        "batch_size": 84,
        "seq_len": 512,
        "eval_tokens": 256,
        "micro_batch_size": 16,
        "lossless_wrapper": 1
      },
      "env": {
        "all": {
          "BLOOMBEE_LOSSLESS_WRAPPER": "{lossless_wrapper}"
        },
        "server1": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "server2": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        },
        "client": {
          "BLOOMBEE_MICRO_BATCH_SIZE": "{micro_batch_size}"
        }
      }
    }
  ]
}
